<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ›ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø­Ø¸ | Admin</title>
  <style>
    body {font-family:"Cairo",sans-serif;background:linear-gradient(135deg,#1e1b4b,#312e81);color:white;text-align:center;margin:0;padding:20px;}
    h1 {font-size:2rem;background:linear-gradient(90deg,#fbbf24,#f87171);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px;}
    .container {max-width:600px;margin:auto;display:none;}
    input,button {padding:10px;border:none;border-radius:8px;margin:5px;font-family:inherit;}
    input {width:70%;background:#2d3566;color:white;}
    button {cursor:pointer;}
    .btn-add {background:#10b981;color:white;}
    .btn-spin {background:linear-gradient(135deg,#fbbf24,#f87171);color:white;font-weight:bold;}
    ul {list-style:none;padding:0;margin-top:10px;}
    li {background:#2b3360;margin:5px 0;padding:8px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;}
    #lockScreen {position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fbbf24;font-size:1.2rem;}
    #lockScreen input {margin-top:12px;padding:10px 15px;font-size:1.05rem;border-radius:8px;border:2px solid #fbbf24;background:#1e1b4b;color:white;text-align:center;width:220px;}
    #lockScreen button {margin-top:12px;background:#fbbf24;border:none;border-radius:8px;padding:10px 16px;font-size:1rem;cursor:pointer;}
    .show-toggle {margin-top:8px;color:#dcdcdc;font-size:0.95rem; display:flex; gap:8px; align-items:center; justify-content:center;}
    .show-toggle input[type="checkbox"] {width:16px;height:16px;cursor:pointer;}
  </style>
</head>
<body>
  <div id="lockScreen">
    <div style="font-size:1.25rem;">ğŸ”’ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <!-- type Ù‡Ù†Ø§ Ø³ÙŠÙƒÙˆÙ† Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ (password <-> text) -->
    <input type="password" id="adminPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autofocus />
    <div class="show-toggle">
      <input type="checkbox" id="showPass" />
      <label for="showPass">Ø£Ø¸Ù‡Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©</label>
    </div>
    <button onclick="checkPassword()">ØªØ£ÙƒÙŠØ¯</button>
  </div>

  <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø­Ø¸</h1>
  <div class="container" id="adminPanel">
    <input type="text" id="playerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" />
    <button class="btn-add" onclick="addPlayer()">â• Ø¥Ø¶Ø§ÙØ©</button>
    <ul id="playerList"></ul>
    <button class="btn-spin" onclick="startSpin()">â–¶ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†</button>
  </div>

  <!-- Firebase v10 (Ù…Ø­Ù…ÙˆÙ„ ÙƒÙ€ module) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase (ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù…Ù„ÙÙƒ)
    const firebaseConfig = {
      apiKey: "AIzaSyAfMcEkpOXgWGE-1d8EVZAJJXXMNeh2thQ",
      authDomain: "luck-wheel-7f514.firebaseapp.com",
      databaseURL: "https://luck-wheel-7f514-default-rtdb.firebaseio.com",
      projectId: "luck-wheel-7f514",
      storageBucket: "luck-wheel-7f514.firebasestorage.app",
      messagingSenderId: "845157453311",
      appId: "1:845157453311:web:c7e9e884c8aa745885ebca"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Ø¹Ù†Ø§ØµØ± DOM
    const nameInput = document.getElementById("playerName");
    const list = document.getElementById("playerList");
    const adminPassInput = document.getElementById("adminPass");
    const showPassCheckbox = document.getElementById("showPass");

    // ØªØ¨Ø¯ÙŠÙ„ Ø±Ø¤ÙŠØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
    showPassCheckbox.addEventListener("change", () => {
      adminPassInput.type = showPassCheckbox.checked ? "text" : "password";
      // Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø± ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
      adminPassInput.focus();
    });

    // ØªØ­Ù‚Ù‚ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ­Ø©
    window.checkPassword = function() {
      const pass = adminPassInput.value.trim();
      if (pass === "521988") {
        document.getElementById("lockScreen").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        // Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        startListeningPlayers();
      } else {
        alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
        adminPassInput.value = "";
        adminPassInput.focus();
      }
    };

    // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø­ÙŠØ© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    let playersRef = ref(db, "wheel/players");
    function startListeningPlayers() {
      onValue(playersRef, snapshot => {
        const data = snapshot.val() || {};
        list.innerHTML = "";
        Object.entries(data).forEach(([id, player]) => {
          const li = document.createElement("li");
          li.textContent = player.name;
          const del = document.createElement("button");
          del.textContent = "âŒ";
          del.style.background = "#ef4444";
          del.onclick = () => remove(ref(db, "wheel/players/" + id));
          li.appendChild(del);
          list.appendChild(li);
        });
      });
    }

    // Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨
    window.addPlayer = function() {
      const name = nameInput.value.trim();
      if (!name) {
        alert("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£ÙˆÙ„Ø§Ù‹!");
        nameInput.focus();
        return;
      }
      const newRef = push(ref(db, "wheel/players"));
      set(newRef, { name })
        .then(() => {
          nameInput.value = "";
        })
        .catch(e => alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: " + e.message));
    };

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† (ÙŠÙƒØªØ¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ wheel/state)
    window.startSpin = function() {
      get(playersRef).then(snap => {
        const players = Object.values(snap.val() || {});
        if (players.length === 0) {
          alert("âš ï¸ Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ù‹Ø§!");
          return;
        }
        const winner = players[Math.floor(Math.random() * players.length)].name;
        const spins = 10 + Math.random() * 5;
        const rotation = spins * 360 + Math.random() * 360;
        set(ref(db, "wheel/state"), { rotation, winner, timestamp: Date.now() })
          .then(() => alert("ğŸ‰ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø²: " + winner))
          .catch(e => alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø©: " + e.message));
      });
    };
  </script>
</body>
</html>
